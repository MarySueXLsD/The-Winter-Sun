<Window x:Class="VisualNovel.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:VisualNovel"
        Title="Visual Novel" Height="600" Width="800"
        WindowStyle="None" WindowState="Maximized"
        Background="Black"
        KeyDown="Window_KeyDown"
        Loaded="Window_Loaded"
        IsVisibleChanged="Window_IsVisibleChanged">
    <Window.Resources>
        <!-- Minecraft Font Family (will be overridden programmatically if font file exists) -->
        <FontFamily x:Key="MinecraftFont">Arial</FontFamily>
        
        <!-- Menu Button Style with Animations -->
        <Style x:Key="MenuButtonStyle" TargetType="Button">
            <Setter Property="Width" Value="220"/>
            <Setter Property="Height" Value="45"/>
            <Setter Property="Margin" Value="0,8"/>
            <Setter Property="FontSize" Value="17"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#CCFFFFFF"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="Padding" Value="15,0,0,0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="ButtonBorder" 
                               Background="{TemplateBinding Background}" 
                               BorderThickness="{TemplateBinding BorderThickness}"
                               CornerRadius="3">
                            <Grid>
                                <Border x:Name="HighlightBorder" 
                                       Background="#20FFFFFF" 
                                       CornerRadius="3"
                                       Opacity="0">
                                    <Border.Effect>
                                        <DropShadowEffect x:Name="GlowEffect"
                                                         BlurRadius="10" 
                                                         ShadowDepth="0" 
                                                         Color="#FFFFD700" 
                                                         Opacity="0"/>
                                    </Border.Effect>
                                </Border>
                                <TextBlock x:Name="ButtonText"
                                          FontFamily="{StaticResource MinecraftFont}"
                                          HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" 
                                          VerticalAlignment="Center"
                                          Margin="{TemplateBinding Padding}">
                                    <TextBlock.Text>
                                        <Binding Path="Content" RelativeSource="{RelativeSource TemplatedParent}">
                                            <Binding.Converter>
                                                <local:ContentToStringConverter/>
                                            </Binding.Converter>
                                        </Binding>
                                    </TextBlock.Text>
                                    <TextBlock.Foreground>
                                        <SolidColorBrush x:Name="TextBrush" Color="#CCFFFFFF"/>
                                    </TextBlock.Foreground>
                                </TextBlock>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Trigger.EnterActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetName="HighlightBorder"
                                                           Storyboard.TargetProperty="Opacity"
                                                           To="1" Duration="0:0:0.2"/>
                                            <DoubleAnimation Storyboard.TargetName="GlowEffect"
                                                           Storyboard.TargetProperty="Opacity"
                                                           To="0.8" Duration="0:0:0.2"/>
                                            <ColorAnimation Storyboard.TargetName="TextBrush"
                                                          Storyboard.TargetProperty="Color"
                                                          To="#FFFFD700" Duration="0:0:0.2"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.EnterActions>
                                <Trigger.ExitActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetName="HighlightBorder"
                                                           Storyboard.TargetProperty="Opacity"
                                                           To="0" Duration="0:0:0.2"/>
                                            <DoubleAnimation Storyboard.TargetName="GlowEffect"
                                                           Storyboard.TargetProperty="Opacity"
                                                           To="0" Duration="0:0:0.2"/>
                                            <ColorAnimation Storyboard.TargetName="TextBrush"
                                                          Storyboard.TargetProperty="Color"
                                                          To="#CCFFFFFF" Duration="0:0:0.2"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.ExitActions>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    
    <Grid>
        <!-- Image Background (Fallback) -->
        <Image x:Name="BackgroundImage" 
               Stretch="UniformToFill"
               Opacity="0.85"
               Visibility="Collapsed"/>
        
        <!-- Video Background -->
        <MediaElement x:Name="BackgroundVideo" 
                     LoadedBehavior="Manual" 
                     UnloadedBehavior="Manual"
                     Stretch="UniformToFill"
                     Volume="0.3"
                     MediaEnded="BackgroundVideo_MediaEnded"
                     Opacity="0.85"/>
        
        <!-- Background Music - Autumn Ambient -->
        <MediaElement x:Name="BackgroundMusic" 
                     LoadedBehavior="Manual" 
                     UnloadedBehavior="Manual"
                     Volume="0.5"
                     MediaEnded="BackgroundMusic_MediaEnded"/>
        
        <!-- Background Music - City Ambient -->
        <MediaElement x:Name="BackgroundMusic2" 
                     LoadedBehavior="Manual" 
                     UnloadedBehavior="Manual"
                     Volume="0.5"
                     MediaEnded="BackgroundMusic2_MediaEnded"/>

        <!-- Dark Overlay for better text visibility -->
        <Rectangle Fill="#40000000"/>

        <!-- Transition Dark Overlay (for menu fade out) -->
        <Rectangle x:Name="TransitionDarkOverlay"
                   Fill="Black"
                   Opacity="0"
                   Visibility="Collapsed">
            <Rectangle.CacheMode>
                <BitmapCache EnableClearType="False" RenderAtScale="1"/>
            </Rectangle.CacheMode>
        </Rectangle>

        <!-- Chapter Title Display (for transition) -->
        <Grid x:Name="ChapterTitleDisplay"
              VerticalAlignment="Center"
              HorizontalAlignment="Center"
              Opacity="0"
              Visibility="Collapsed">
            <Grid.CacheMode>
                <BitmapCache EnableClearType="False" RenderAtScale="1"/>
            </Grid.CacheMode>
            <TextBlock x:Name="ChapterTitleText"
                      Text="Religious Nobility"
                      FontFamily="{StaticResource MinecraftFont}"
                      FontSize="96"
                      FontWeight="Bold"
                      Foreground="#FFFFD700"
                      TextAlignment="Center"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Center"
                      RenderTransformOrigin="0.5,0.5">
                <TextBlock.CacheMode>
                    <BitmapCache EnableClearType="False" RenderAtScale="1.2"/>
                </TextBlock.CacheMode>
                <TextBlock.RenderTransform>
                    <ScaleTransform x:Name="ChapterTitleScale" ScaleX="1" ScaleY="1"/>
                </TextBlock.RenderTransform>
                <TextBlock.Effect>
                    <DropShadowEffect BlurRadius="20"
                                     ShadowDepth="0"
                                     Color="#FFFFD700"
                                     Opacity="0.8"/>
                </TextBlock.Effect>
            </TextBlock>
        </Grid>

        <!-- Loading Overlay with fade animation -->
        <Border x:Name="LoadingOverlay"
                Background="Black"
                Opacity="1"
                Visibility="Visible">
            <Border.Resources>
                <Storyboard x:Key="FadeOutStoryboard">
                    <DoubleAnimation Storyboard.TargetName="LoadingOverlay"
                                   Storyboard.TargetProperty="Opacity"
                                   From="1" To="0" Duration="0:0:0.5">
                        <DoubleAnimation.EasingFunction>
                            <CubicEase EasingMode="EaseOut"/>
                        </DoubleAnimation.EasingFunction>
                    </DoubleAnimation>
                </Storyboard>
            </Border.Resources>
            <Grid VerticalAlignment="Center" HorizontalAlignment="Center">
                <TextBlock Text="Loading..."
                          FontFamily="{StaticResource MinecraftFont}"
                          FontSize="25"
                          Foreground="#FFFFD700"
                          FontWeight="SemiBold"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Center">
                    <TextBlock.Effect>
                        <DropShadowEffect BlurRadius="10" 
                                         ShadowDepth="0" 
                                         Color="#FFFFD700" 
                                         Opacity="0.8"/>
                    </TextBlock.Effect>
                </TextBlock>
            </Grid>
        </Border>

        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="350"/>
            </Grid.ColumnDefinitions>

            <!-- Right Sidebar with Title and Menu Buttons -->
            <Border x:Name="MenuSidebar" Grid.Column="1"
                   Background="#80000000" 
                   BorderBrush="#40FFFFFF" 
                   BorderThickness="2,0,0,0"
                   VerticalAlignment="Stretch"
                   HorizontalAlignment="Stretch"
                   Padding="30,20">
                <StackPanel VerticalAlignment="Center">
                    <!-- Title Section -->
                    <TextBlock x:Name="GameTitle" 
                              Text="Psalm 0" 
                              FontFamily="{StaticResource MinecraftFont}"
                              FontSize="39" 
                              FontWeight="Bold" 
                              Foreground="#FFFFD700"
                              TextAlignment="Center"
                              LineHeight="45"
                              Margin="0,0,0,20"
                              TextWrapping="Wrap">
                        <TextBlock.Effect>
                            <DropShadowEffect BlurRadius="15" 
                                             ShadowDepth="3" 
                                             Color="#FFFFD700" 
                                             Opacity="0.6"/>
                        </TextBlock.Effect>
                    </TextBlock>
                    <TextBlock x:Name="SubtitleText"
                              Text="Silent Mother, Starving God" 
                              FontFamily="{StaticResource MinecraftFont}"
                              FontSize="15" 
                              Foreground="#AAFFFFFF" 
                              TextAlignment="Center"
                              FontStyle="Italic"
                              Margin="0,0,0,30"/>
                    
                    <!-- Menu Buttons -->
                    <Button x:Name="ContinueButton" 
                           Content="Continue" 
                           Style="{StaticResource MenuButtonStyle}"
                           Click="ContinueButton_Click"
                           Visibility="Collapsed"/>
                    <Button x:Name="NewGameButton" 
                           Content="New Game" 
                           Style="{StaticResource MenuButtonStyle}"
                           Click="NewGameButton_Click"/>
                    <Button x:Name="LoadGameButton" 
                           Content="Load Game" 
                           Style="{StaticResource MenuButtonStyle}"
                           Click="LoadGameButton_Click"/>
                    <Button x:Name="OptionsButton" 
                           Content="Options" 
                           Style="{StaticResource MenuButtonStyle}"
                           Click="OptionsButton_Click"/>
                    <Button x:Name="CreditsButton" 
                           Content="Credits" 
                           Style="{StaticResource MenuButtonStyle}"
                           Click="CreditsButton_Click"/>
                    <Button x:Name="QuitButton" 
                           Content="Quit" 
                           Style="{StaticResource MenuButtonStyle}"
                           Click="QuitButton_Click"/>
                </StackPanel>
            </Border>

            <!-- Version Text -->
            <TextBlock x:Name="VersionText"
                      Grid.Column="0"
                      Text="Early Build 0.01.4" 
                      FontFamily="{StaticResource MinecraftFont}"
                      FontSize="14" 
                      Foreground="#80FFFFFF" 
                      HorizontalAlignment="Left" 
                      VerticalAlignment="Bottom"
                      Margin="20,0,0,20"/>

            <!-- FPS Counter -->
            <TextBlock x:Name="FPSCounter" 
                      Grid.Column="1"
                      Text="FPS: 60" 
                      FontFamily="{StaticResource MinecraftFont}"
                      FontSize="14" 
                      Foreground="#80FFFFFF" 
                      HorizontalAlignment="Right" 
                      VerticalAlignment="Bottom"
                      Margin="0,0,20,20"/>
        </Grid>
    </Grid>
</Window>
