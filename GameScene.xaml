<Window x:Class="VisualNovel.GameScene"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:VisualNovel"
        Title="Visual Novel - Game" Height="600" Width="1000"
        WindowStyle="None" WindowState="Maximized"
        KeyDown="Window_KeyDown" MouseDown="Window_MouseDown" MouseMove="Window_MouseMove" MouseLeave="Window_MouseLeave"
        Background="#FF1A1A0A"
        RenderOptions.BitmapScalingMode="HighQuality"
        RenderOptions.CachingHint="Cache"
        UseLayoutRounding="True">
    <Window.Resources>
        <!-- Post-Soviet Old TV Style Effects -->
        <DropShadowEffect x:Key="BeigeGlow" Color="#FFD4C4A0" BlurRadius="3" ShadowDepth="0" Opacity="0.4"/>
        <DropShadowEffect x:Key="YellowGlow" Color="#FFFFD700" BlurRadius="3" ShadowDepth="0" Opacity="0.4"/>
    </Window.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="260"/>
        </Grid.RowDefinitions>
        
        <!-- Background Music -->
        <MediaElement x:Name="GameBackgroundMusic" 
                     LoadedBehavior="Manual" 
                     UnloadedBehavior="Manual"
                     Volume="0.5"
                     MediaEnded="GameBackgroundMusic_MediaEnded"/>

        <!-- Background Image Area with Camera Transform -->
        <Border Grid.Row="0" Grid.RowSpan="2" ClipToBounds="True" x:Name="CameraContainer">
            <Border.RenderTransform>
                <TransformGroup>
                    <ScaleTransform x:Name="CameraZoomTransform" ScaleX="1" ScaleY="1" CenterX="0.5" CenterY="0.5"/>
                    <TranslateTransform x:Name="CameraPanTransform" X="0" Y="0"/>
                </TransformGroup>
            </Border.RenderTransform>
            <Grid>
                <!-- Background Image with Parallax Transform -->
                <Border ClipToBounds="True">
                    <Border.RenderTransform>
                        <TransformGroup>
                            <TranslateTransform x:Name="BackgroundParallaxTransform" X="0" Y="0"/>
                        </TransformGroup>
                    </Border.RenderTransform>
                    <Image x:Name="BackgroundImage" Stretch="UniformToFill" Opacity="0.7" VerticalAlignment="Stretch" HorizontalAlignment="Stretch"/>
                </Border>
                
                <!-- Character Container for positioning with Parallax Transform -->
                <Canvas x:Name="CharacterContainer" ClipToBounds="True"
                        HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                        Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Grid}}"
                        Height="{Binding ActualHeight, RelativeSource={RelativeSource AncestorType=Grid}}">
                    <Canvas.RenderTransform>
                        <TransformGroup>
                            <TranslateTransform x:Name="CharacterParallaxTransform" X="0" Y="0"/>
                        </TransformGroup>
                    </Canvas.RenderTransform>
                    <!-- Character Image Left (Sister MaÅ‚gorzata) - Slot 1 -->
                    <Border Canvas.Left="0" Canvas.Bottom="0" 
                            ClipToBounds="True" Visibility="Collapsed" x:Name="CharacterImageLeftBorder"
                            Width="650" Height="1000">
                        <Image x:Name="CharacterImageLeft" 
                               Stretch="Uniform" 
                               VerticalAlignment="Bottom"
                               RenderOptions.BitmapScalingMode="HighQuality" 
                           RenderOptions.EdgeMode="Unspecified"
                           SnapsToDevicePixels="False"
                           UseLayoutRounding="True"
                           Opacity="1.0">
                            <Image.LayoutTransform>
                                <TransformGroup>
                                    <ScaleTransform x:Name="CharacterImageLeftScale" ScaleX="1" ScaleY="1" CenterX="0.5" CenterY="0.5"/>
                                </TransformGroup>
                            </Image.LayoutTransform>
                        </Image>
                    </Border>
                    
                    <!-- Character Image Right (Sister Agata) - Slot 2 -->
                    <Border Canvas.Left="0" Canvas.Bottom="0" 
                            ClipToBounds="True" Visibility="Collapsed" x:Name="CharacterImageRightBorder"
                            Width="650" Height="1000">
                        <Image x:Name="CharacterImageRight" 
                           Stretch="Uniform" 
                           VerticalAlignment="Bottom"
                           RenderOptions.BitmapScalingMode="HighQuality" 
                           RenderOptions.EdgeMode="Unspecified"
                           SnapsToDevicePixels="False"
                           UseLayoutRounding="True"
                           Opacity="1.0">
                            <Image.LayoutTransform>
                                <TransformGroup>
                                    <ScaleTransform x:Name="CharacterImageRightScale" ScaleX="1" ScaleY="1" CenterX="0.5" CenterY="0.5"/>
                                </TransformGroup>
                            </Image.LayoutTransform>
                        </Image>
                    </Border>
                    
                    <!-- Additional Character Slots (3-6) for multiple characters -->
                    <Border Canvas.Left="0" Canvas.Bottom="0" 
                            ClipToBounds="True" Visibility="Collapsed" x:Name="CharacterImageSlot3Border"
                            Width="650" Height="1000">
                        <Image x:Name="CharacterImageSlot3" 
                           Stretch="Uniform" 
                           VerticalAlignment="Bottom"
                           RenderOptions.BitmapScalingMode="HighQuality" 
                           RenderOptions.EdgeMode="Unspecified"
                           SnapsToDevicePixels="False"
                           UseLayoutRounding="True"
                           Opacity="1.0">
                            <Image.LayoutTransform>
                                <TransformGroup>
                                    <ScaleTransform x:Name="CharacterImageSlot3Scale" ScaleX="1" ScaleY="1" CenterX="0.5" CenterY="0.5"/>
                                </TransformGroup>
                            </Image.LayoutTransform>
                        </Image>
                    </Border>
                    
                    <Border Canvas.Left="0" Canvas.Bottom="0" 
                            ClipToBounds="True" Visibility="Collapsed" x:Name="CharacterImageSlot4Border"
                            Width="650" Height="1000">
                        <Image x:Name="CharacterImageSlot4" 
                           Stretch="Uniform" 
                           VerticalAlignment="Bottom"
                           RenderOptions.BitmapScalingMode="HighQuality" 
                           RenderOptions.EdgeMode="Unspecified"
                           SnapsToDevicePixels="False"
                           UseLayoutRounding="True"
                           Opacity="1.0">
                            <Image.LayoutTransform>
                                <TransformGroup>
                                    <ScaleTransform x:Name="CharacterImageSlot4Scale" ScaleX="1" ScaleY="1" CenterX="0.5" CenterY="0.5"/>
                                </TransformGroup>
                            </Image.LayoutTransform>
                        </Image>
                    </Border>
                    
                    <Border Canvas.Left="0" Canvas.Bottom="0" 
                            ClipToBounds="True" Visibility="Collapsed" x:Name="CharacterImageSlot5Border"
                            Width="650" Height="1000">
                        <Image x:Name="CharacterImageSlot5" 
                           Stretch="Uniform" 
                           VerticalAlignment="Bottom"
                           RenderOptions.BitmapScalingMode="HighQuality" 
                           RenderOptions.EdgeMode="Unspecified"
                           SnapsToDevicePixels="False"
                           UseLayoutRounding="True"
                           Opacity="1.0">
                            <Image.LayoutTransform>
                                <TransformGroup>
                                    <ScaleTransform x:Name="CharacterImageSlot5Scale" ScaleX="1" ScaleY="1" CenterX="0.5" CenterY="0.5"/>
                                </TransformGroup>
                            </Image.LayoutTransform>
                        </Image>
                    </Border>
                    
                    <Border Canvas.Left="0" Canvas.Bottom="0" 
                            ClipToBounds="True" Visibility="Collapsed" x:Name="CharacterImageSlot6Border"
                            Width="650" Height="1000">
                        <Image x:Name="CharacterImageSlot6" 
                           Stretch="Uniform" 
                           VerticalAlignment="Bottom"
                           RenderOptions.BitmapScalingMode="HighQuality" 
                           RenderOptions.EdgeMode="Unspecified"
                           SnapsToDevicePixels="False"
                           UseLayoutRounding="True"
                           Opacity="1.0">
                            <Image.LayoutTransform>
                                <TransformGroup>
                                    <ScaleTransform x:Name="CharacterImageSlot6Scale" ScaleX="1" ScaleY="1" CenterX="0.5" CenterY="0.5"/>
                                </TransformGroup>
                            </Image.LayoutTransform>
                        </Image>
                    </Border>
                </Canvas>
                
                <!-- Snow Falling Ambient Animation - Above characters, below UI -->
                <!-- Using animated frame sequence with chroma key for black-to-transparent -->
                <local:AnimatedChromaKeyImage x:Name="SnowVideo" 
                                             Stretch="UniformToFill"
                                             HorizontalAlignment="Stretch"
                                             VerticalAlignment="Stretch"
                                             FramesPath="Assets\Videos\snow-falling-ambient-frames"
                                             ColorKey="Black"
                                             Tolerance="0.3"
                                             FrameRate="30"
                                             Visibility="Visible"/>
            </Grid>
        </Border>

        <!-- Post-Soviet Dialogue Container -->
        <Border Grid.Row="1" Background="#FFE8D4B0" BorderBrush="#FFD4C4A0" BorderThickness="3" Margin="15,10">
            <Border.Effect>
                <DropShadowEffect Color="#FF8B7355" BlurRadius="8" ShadowDepth="2" Opacity="0.6"/>
            </Border.Effect>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Character Name -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="15,12,15,8" VerticalAlignment="Center">
                    <TextBlock x:Name="CharacterNameText" 
                              Text="CHARACTER" FontSize="28" FontWeight="Bold" 
                              Foreground="#FF8B4513"
                              Effect="{StaticResource BeigeGlow}"/>
                    <TextBlock x:Name="CharacterStatusText" 
                              Text="" FontSize="18" 
                              Foreground="#FF808080" 
                              Margin="8,0,0,0"
                              VerticalAlignment="Center"
                              Effect="{StaticResource BeigeGlow}"/>
                </StackPanel>

                <!-- Dialogue Text -->
                <TextBlock x:Name="DialogueText" Grid.Row="1" 
                          Text="Dialogue text will appear here..." 
                          FontSize="28" Foreground="#FF2A1A0A" 
                          TextWrapping="Wrap" Margin="15,5,15,15"
                          LineHeight="56"/>

                <!-- Version Text (Bottom Left of dialogue box) -->
                <TextBlock x:Name="VersionText"
                          Grid.Row="1"
                          Text="Early Build 0.01.4" 
                          FontSize="14" 
                          Foreground="#FF000000" 
                          HorizontalAlignment="Left" 
                          VerticalAlignment="Bottom"
                          Margin="15,0,0,15"/>
                
                <!-- FPS Counter (Bottom Right of dialogue box) -->
                <TextBlock x:Name="FPSCounter"
                          Grid.Row="1"
                          Text="FPS: 60" 
                          FontSize="14" 
                          Foreground="#FF000000" 
                          HorizontalAlignment="Right" 
                          VerticalAlignment="Bottom"
                          Margin="0,0,15,15"/>
            </Grid>
        </Border>

        <!-- Skip Indicator -->
        <TextBlock x:Name="SkipIndicator" Grid.Row="1" 
                  Text="[ENTER/SPACE/CLICK]" 
                  FontSize="20" Foreground="#FF8B7355" 
                  HorizontalAlignment="Right" VerticalAlignment="Top"
                  Margin="20,20,20,0" Opacity="0.8"/>

        <!-- Choice Menu Overlay -->
        <local:ChoiceMenu x:Name="ChoiceMenuControl" Grid.RowSpan="2" 
                   Visibility="Collapsed"/>

        <!-- Location and Time Indicator (Top Left) -->
        <StackPanel HorizontalAlignment="Left" VerticalAlignment="Top" Margin="20,20,0,0">
            <TextBlock x:Name="LocationText" 
                      Text="LOCATION" 
                      FontSize="28" FontWeight="Bold" 
                      Foreground="#FF202020" 
                      Effect="{StaticResource BeigeGlow}"/>
            <StackPanel x:Name="TimeContainer" Orientation="Horizontal" Margin="0,2,0,0">
                <TextBlock x:Name="TimeHours" 
                          Text="09" 
                          FontSize="24" FontWeight="Bold" 
                          Foreground="#FF202020" 
                          Effect="{StaticResource BeigeGlow}"/>
                <TextBlock x:Name="TimeColon" 
                          Text=":" 
                          FontSize="24" FontWeight="Bold" 
                          Foreground="#FF202020" 
                          Effect="{StaticResource BeigeGlow}"/>
                <TextBlock x:Name="TimeMinutes" 
                          Text="32" 
                          FontSize="24" FontWeight="Bold" 
                          Foreground="#FF202020" 
                          Effect="{StaticResource BeigeGlow}"/>
            </StackPanel>
        </StackPanel>

        <!-- Chapter Title (Top Center) -->
        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Top" Margin="0,20,0,0" Loaded="ChapterTitlePanel_Loaded">
            <TextBlock x:Name="ChapterTitleText" 
                      Text="Chapter 1: Religious Nobility" 
                      FontSize="24" FontWeight="Bold" 
                      Foreground="#FFD4AF37" 
                      HorizontalAlignment="Center"
                      Effect="{StaticResource YellowGlow}"/>
            <Border x:Name="ChapterTitleLine" 
                    Height="2" 
                    Background="#FFD4AF37" 
                    Margin="0,8,0,0"
                    HorizontalAlignment="Center"/>
        </StackPanel>

        <!-- Menu Buttons -->
        <StackPanel HorizontalAlignment="Right" VerticalAlignment="Top" 
                   Orientation="Horizontal" Margin="20">
            <Button x:Name="SaveButton" Content="Save (Ctrl+S)" 
                   Margin="0,0,10,0" Padding="12,6" Click="SaveButton_Click"
                   Background="#AAD4C4A0" Foreground="#FF8B7355" BorderBrush="#FFD4C4A0" BorderThickness="2"
                   FontSize="14" FontWeight="Bold">
                <Button.Effect>
                    <DropShadowEffect Color="#FF8B7355" BlurRadius="3" ShadowDepth="1" Opacity="0.5"/>
                </Button.Effect>
            </Button>
            <Button x:Name="LoadButton" Content="Load (Ctrl+L)" 
                   Margin="0,0,10,0" Padding="12,6" Click="LoadButton_Click"
                   Background="#AAD4C4A0" Foreground="#FF8B7355" BorderBrush="#FFD4C4A0" BorderThickness="2"
                   FontSize="14" FontWeight="Bold">
                <Button.Effect>
                    <DropShadowEffect Color="#FF8B7355" BlurRadius="3" ShadowDepth="1" Opacity="0.5"/>
                </Button.Effect>
            </Button>
            <Button x:Name="MenuButton" Content="Menu (Esc)" 
                   Padding="12,6" Click="MenuButton_Click"
                   Background="#AAD4C4A0" Foreground="#FF8B7355" BorderBrush="#FFD4C4A0" BorderThickness="2"
                   FontSize="14" FontWeight="Bold">
                <Button.Effect>
                    <DropShadowEffect Color="#FF8B7355" BlurRadius="3" ShadowDepth="1" Opacity="0.5"/>
                </Button.Effect>
            </Button>
        </StackPanel>

        <!-- Dark Overlay - covers everything to prevent white flash, fades out after scene loads -->
        <Rectangle x:Name="SceneTransitionOverlay" 
                   Grid.RowSpan="2"
                   Fill="Black" 
                   Opacity="1.0"/>
    </Grid>
</Window>

